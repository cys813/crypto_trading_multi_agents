# Data Collection Agent

æ•°æ®æ”¶é›†ä»£ç† - åŸºäºCCXTåº“çš„å¤šäº¤æ˜“æ‰€ç»Ÿä¸€æ•°æ®æ¥å£ç³»ç»Ÿ

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- **å¤šäº¤æ˜“æ‰€æ”¯æŒ**: æ”¯æŒBinanceã€OKXã€Huobiã€Coinbaseã€Krakenç­‰ä¸»æµäº¤æ˜“æ‰€
- **å®æ—¶æ•°æ®æ”¶é›†**: OHLCVã€å®æ—¶è¡Œæƒ…ã€è®¢å•ç°¿æ·±åº¦ã€å†å²äº¤æ˜“æ•°æ®
- **ä»“ä½ç®¡ç†**: å®æ—¶ä»“ä½åŒæ­¥ã€PnLè®¡ç®—ã€é£é™©è¯„ä¼°
- **è®¢å•ç®¡ç†**: è®¢å•çŠ¶æ€ç›‘æ§ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€æ‰§è¡Œæ•ˆç‡åˆ†æ
- **æ™ºèƒ½è°ƒåº¦**: è‡ªåŠ¨åŒ–æ•°æ®æ”¶é›†ã€ä¼˜å…ˆçº§ç®¡ç†ã€è´Ÿè½½å‡è¡¡
- **è´¨é‡ç›‘æ§**: æ•°æ®éªŒè¯ã€å¼‚å¸¸æ£€æµ‹ã€è´¨é‡è¯„åˆ†

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Collection Agent                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Exchange Manager   â”‚  Data Collector  â”‚  Position Manager â”‚
â”‚  - è¿æ¥ç®¡ç†         â”‚  - è‡ªåŠ¨è°ƒåº¦       â”‚  - å®æ—¶åŒæ­¥       â”‚
â”‚  - è´Ÿè½½å‡è¡¡         â”‚  - æ™ºèƒ½æ”¶é›†       â”‚  - PnLè®¡ç®—        â”‚
â”‚  - æ•…éšœè½¬ç§»         â”‚  - è´¨é‡æ§åˆ¶       â”‚  - é£é™©è¯„ä¼°       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Order Manager      â”‚  Data Processor  â”‚  API Services     â”‚
â”‚  - è®¢å•ç”Ÿå‘½å‘¨æœŸ     â”‚  - æ•°æ®æ¸…æ´—       â”‚  - RESTful API    â”‚
â”‚  - æ‰§è¡Œåˆ†æ         â”‚  - æ ‡å‡†åŒ–         â”‚  - WebSocket      â”‚
â”‚  - æ€§èƒ½ç»Ÿè®¡         â”‚  - è´¨é‡æ£€æŸ¥       â”‚  - æ•°æ®å¯¼å‡º       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Data Storage                           â”‚
â”‚  TimescaleDB (æ—¶åº) â”‚  PostgreSQL (ä¸šåŠ¡)  â”‚  Redis (ç¼“å­˜)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡ï¼Œæ·»åŠ äº¤æ˜“æ‰€APIå¯†é’¥
# è‡³å°‘éœ€è¦é…ç½®ä¸€ä¸ªäº¤æ˜“æ‰€çš„APIå¯†é’¥
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. å¯åŠ¨æ•°æ®åº“

```bash
# ä½¿ç”¨Dockerå¯åŠ¨æ•°æ®åº“æœåŠ¡
docker-compose up -d postgres timescaledb redis
```

### 4. è¿è¡Œç³»ç»Ÿ

```bash
# å¯åŠ¨æ•°æ®æ”¶é›†ä»£ç†
python -m src.data_collection.main
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | æè¿° | å¿…éœ€ | ç¤ºä¾‹ |
|-------|------|------|------|
| `BINANCE_API_KEY` | Binance APIå¯†é’¥ | æ˜¯ | `your_api_key` |
| `BINANCE_API_SECRET` | Binance APIå¯†é’¥ | æ˜¯ | `your_api_secret` |
| `OKX_API_KEY` | OKX APIå¯†é’¥ | å¦ | `your_api_key` |
| `OKX_API_SECRET` | OKX APIå¯†é’¥ | å¦ | `your_api_secret` |
| `OKX_API_PASSPHRASE` | OKX APIå¯†ç  | å¦ | `your_passphrase` |
| `POSTGRES_HOST` | PostgreSQLä¸»æœº | å¦ | `localhost` |
| `POSTGRES_DB` | PostgreSQLæ•°æ®åº“å | å¦ | `crypto_trading` |
| `REDIS_HOST` | Redisä¸»æœº | å¦ | `localhost` |
| `LOG_LEVEL` | æ—¥å¿—çº§åˆ« | å¦ | `INFO` |

### æ”¯æŒçš„äº¤æ˜“æ‰€

- **Binance** - æ”¯æŒç°è´§ã€æœŸè´§ã€æœŸæƒ
- **OKX** - æ”¯æŒç°è´§ã€æœŸè´§ã€æœŸæƒ
- **Huobi** - æ”¯æŒç°è´§ã€æœŸè´§
- **Coinbase** - æ”¯æŒç°è´§
- **Kraken** - æ”¯æŒç°è´§ã€æœŸè´§

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### ç³»ç»ŸæŒ‡æ ‡
- æ•°æ®æ”¶é›†æˆåŠŸç‡
- APIå“åº”æ—¶é—´
- è¿æ¥å¥åº·çŠ¶æ€
- å†…å­˜ä½¿ç”¨æƒ…å†µ

### ä¸šåŠ¡æŒ‡æ ‡
- æ•°æ®å»¶è¿Ÿ
- ä»“ä½å®æ—¶æ€§
- è®¢å•çŠ¶æ€åŒæ­¥
- æ•°æ®è´¨é‡è¯„åˆ†

### PrometheusæŒ‡æ ‡
- `data_collection_total` - æ•°æ®æ”¶é›†è®¡æ•°
- `data_collection_duration_seconds` - æ”¶é›†è€—æ—¶
- `active_positions_total` - æ´»è·ƒä»“ä½æ•°é‡
- `api_requests_total` - APIè¯·æ±‚è®¡æ•°

## ğŸ”„ APIæ¥å£

### è·å–å¸‚åœºæ•°æ®
```python
from src.data_collection.core.exchange_manager import ExchangeManager

# åˆ›å»ºäº¤æ˜“æ‰€ç®¡ç†å™¨
config = {
    'binance': ExchangeConfig(
        name='binance',
        api_key='your_key',
        secret='your_secret'
    )
}
manager = ExchangeManager(config)

# è·å–Kçº¿æ•°æ®
ohlcv = await manager.get_ohlcv('binance', 'BTC/USDT', '1m')
```

### è·å–ä»“ä½ä¿¡æ¯
```python
from src.data_collection.core.position_manager import PositionManager

# åˆ›å»ºä»“ä½ç®¡ç†å™¨
position_manager = PositionManager(manager)

# è·å–æ‰€æœ‰ä»“ä½
positions = position_manager.get_all_positions()

# è·å–ä»“ä½æ‘˜è¦
summary = position_manager.get_position_summary()
```

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_exchange_manager.py

# è¿è¡Œæ€§èƒ½æµ‹è¯•
pytest --benchmark-only
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **æ•°æ®è·å–å»¶è¿Ÿ**: < 100ms
- **å¹¶å‘è¿æ¥æ•°**: > 1000
- **æ•°æ®å‡†ç¡®æ€§**: > 99.9%
- **ç³»ç»Ÿå¯ç”¨æ€§**: > 99.9%
- **APIé€Ÿç‡é™åˆ¶**: æ™ºèƒ½ç®¡ç†ï¼Œè‡ªåŠ¨é™æµ

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„
```
src/data_collection/
â”œâ”€â”€ core/                    # æ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ exchange_manager.py  # äº¤æ˜“æ‰€ç®¡ç†
â”‚   â”œâ”€â”€ data_collector.py    # æ•°æ®æ”¶é›†
â”‚   â”œâ”€â”€ position_manager.py  # ä»“ä½ç®¡ç†
â”‚   â”œâ”€â”€ order_manager.py     # è®¢å•ç®¡ç†
â”‚   â””â”€â”€ data_processor.py    # æ•°æ®å¤„ç†
â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹
â”œâ”€â”€ api/                    # APIæœåŠ¡
â”œâ”€â”€ config/                 # é…ç½®ç®¡ç†
â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â””â”€â”€ tests/                  # æµ‹è¯•ç”¨ä¾‹
```

### æ·»åŠ æ–°äº¤æ˜“æ‰€
1. åœ¨ `config/settings.py` ä¸­æ·»åŠ äº¤æ˜“æ‰€é…ç½®
2. åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ APIå¯†é’¥
3. ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åˆå§‹åŒ–æ–°äº¤æ˜“æ‰€

### è‡ªå®šä¹‰æ•°æ®æ”¶é›†
```python
from src.data_collection.core.data_collector import DataCollector, DataType, CollectionTask

# åˆ›å»ºè‡ªå®šä¹‰æ”¶é›†ä»»åŠ¡
task = CollectionTask(
    exchange_name='binance',
    symbol='BTC/USDT',
    data_type=DataType.OHLCV,
    timeframe='15m',
    interval=900,
    priority=2
)

# æ·»åŠ åˆ°æ”¶é›†å™¨
data_collector.add_collection_task(task)
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **APIå¯†é’¥é”™è¯¯**
   - æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„APIå¯†é’¥æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤APIå¯†é’¥æœ‰è¶³å¤Ÿçš„æƒé™

2. **ç½‘ç»œè¿æ¥é—®é¢˜**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤äº¤æ˜“æ‰€APIç«¯ç‚¹å¯è®¿é—®

3. **é€Ÿç‡é™åˆ¶**
   - ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†é€Ÿç‡é™åˆ¶
   - å¦‚é‡é™åˆ¶ï¼Œä¼šè‡ªåŠ¨é‡è¯•

4. **æ•°æ®å»¶è¿Ÿ**
   - æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
   - æŸ¥çœ‹ç½‘ç»œå»¶è¿Ÿ
   - è°ƒæ•´æ”¶é›†é—´éš”

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/data_collection.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep ERROR logs/data_collection.log
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒå¤šäº¤æ˜“æ‰€æ•°æ®æ”¶é›†
- å®ç°ä»“ä½å’Œè®¢å•ç®¡ç†
- æ·»åŠ ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. å¼€å¯Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ†˜ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æäº¤ [GitHub Issues](https://github.com/cys813/crypto_trading_multi_agents/issues)